# ğŸ¥ Hospital Autonomous Wheelchair Robot  


> **ìš”ì•½**  
> TurtleBot3 Burger í”Œë«í¼ì— 3D í”„ë¦°íŒ… íœ ì²´ì–´ êµ¬ì¡°ë¬¼ì„ ì¥ì°©í•˜ê³ ,  
> **LiDAR SLAM ê¸°ë°˜ ììœ¨ì£¼í–‰(ROS2/Nav2)** + **ì¤‘ì•™ ì„œë²„/DB ë°°ì°¨ ì‹œìŠ¤í…œ** + **Qt í„°ì¹˜ í‚¤ì˜¤ìŠ¤í¬(ì™¸ë˜ í˜¸ì¶œ)** + **STM32U5(ì´ˆìŒíŒŒ/ì••ë ¥ + TFT-OLED UI)** ë¥¼ ê²°í•©í•´  
> ë³‘ì› í™˜ê²½ì—ì„œ **í™˜ì í˜¸ì¶œ â†’ íƒ‘ìŠ¹ í™•ì¸ â†’ ëª©ì ì§€ ì´ë™ â†’ ë„ì°© ì•Œë¦¼ â†’ í•˜ì°¨/ëŒ€ê¸°/ì¶©ì „** íë¦„ì„ êµ¬í˜„í•˜ëŠ” í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.

---

## ğŸ“Œ 1. í”„ë¡œì íŠ¸ ëª©í‘œ

- ë³‘ì›ì—ì„œ ê±°ë™ì´ ë¶ˆí¸í•œ í™˜ìê°€ íœ ì²´ì–´ë¥¼ ì‰½ê²Œ í˜¸ì¶œí•˜ê³  ì´ë™í•  ìˆ˜ ìˆë„ë¡ ì§€ì›
- **ì™¸ë˜ í™˜ì**ëŠ” QR ëŒ€ì‹  **í„°ì¹˜ í‚¤ì˜¤ìŠ¤í¬(Qt)** ë¡œ í˜¸ì¶œ
- **ì…ì› í™˜ì**ëŠ” DBì— ë“±ë¡ëœ ë³‘ë™/ë³‘ì‹¤ ì¢Œí‘œ ê¸°ë°˜ìœ¼ë¡œ ë°°ì°¨ ê°€ëŠ¥
- ììœ¨ì£¼í–‰ì€ **LiDAR SLAM + Nav2** ë¡œ ìˆ˜í–‰
- **STM32U5G9J-DK2 ë³´ë“œ**ë¡œ:
  - LiDARê°€ ê°ì§€í•˜ê¸° ì–´ë ¤ìš´ **ë‚®ì€ ë†’ì´ ì¥ì• ë¬¼**ì„ ì´ˆìŒíŒŒë¡œ ê°ì§€
  - **ì••ë ¥ ì„¼ì„œ(FSR)**ë¡œ í™˜ì íƒ‘ìŠ¹/í•˜ì°¨ë¥¼ ê°ì§€í•˜ì—¬ ì„œë²„/DBì— ë°˜ì˜
  - ë³´ë“œ ë‚´ì¥ **TFT-OLED**ì—ì„œ ë¡œë´‡ ìƒíƒœ/í† í”½ê°’ì„ ì‹¤ì‹œê°„ UIë¡œ í‘œì‹œ

---

## âœ¨ 2. í•µì‹¬ ê¸°ëŠ¥ (Key Features)

### âœ… ììœ¨ì£¼í–‰
- SLAMìœ¼ë¡œ ë§µ ìƒì„±
- AMCLë¡œ ìœ„ì¹˜ ì¶”ì •
- Nav2ë¡œ ê²½ë¡œ ê³„íš ë° ëª©í‘œ ì§€ì  ì´ë™

### âœ… ì™¸ë˜ í˜¸ì¶œ: Qt í„°ì¹˜ í‚¤ì˜¤ìŠ¤í¬
- ì™¸ë˜ í™˜ìê°€ í„°ì¹˜ í‚¤ì˜¤ìŠ¤í¬ì—ì„œ â€œíœ ì²´ì–´ í˜¸ì¶œâ€
- ì¶œë°œ/ëª©ì ì§€ ì„ íƒ(ë˜ëŠ” ìŠ¤í…Œì´ì…˜ ê¸°ì¤€ í˜¸ì¶œ)
- í˜¸ì¶œ ì •ë³´ëŠ” ì„œë²„/DBì— ì €ì¥ë˜ê³ , ë°°ì°¨ ë¡œì§ì´ ë¡œë´‡ì„ í• ë‹¹

### âœ… ì„œë²„/DB ê¸°ë°˜ ë°°ì°¨(Dispatch)
- DBì˜ í˜¸ì¶œ í(call queue)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ
  - ê°€ìš© ë¡œë´‡ íƒìƒ‰
  - ìš°ì„ ìˆœìœ„ ë°°ì •
  - ë¡œë´‡ì— start/goal ì¢Œí‘œ ì „ë‹¬
  - ë¡œë´‡ ìƒíƒœë¥¼ DBì— ì§€ì† ê¸°ë¡

### âœ… STM32U5 ë³´ë“œ(ì´ˆìŒíŒŒ + ì••ë ¥) + TFT UI
- ì´ˆìŒíŒŒ(HC-SR04): **í•˜ë‹¨ ì¥ì°©** â†’ ë‚®ì€ ì¥ì• ë¬¼ ê°ì§€ìš©
- ì••ë ¥(FSR): **seat_detected** â†’ íƒ‘ìŠ¹ ê°ì§€ìš©
- TFT-OLED UIì— ROS í† í”½ ê¸°ë°˜ ìƒíƒœ í‘œì‹œ

---

## ğŸ§  3. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (System Architecture)

### êµ¬ì„± ìš”ì†Œ

#### 1) Robot (TurtleBot3 Burger+ Raspberry Pi 4)
- ROS2 (Nav2/SLAM/AMCL)
- LiDAR(`/scan`), odom(`/odom`), ë°°í„°ë¦¬(`/battery_state`) publish
- ì„œë²„ì™€ ë„¤íŠ¸ì›Œí¬ í†µì‹ (í”„ë¡œì íŠ¸ ë°©ì‹ì— ë§ëŠ” ë¸Œë¦¬ì§€/í”„ë¡œí† ì½œ)
- STM32U5 ë³´ë“œì™€ UART/Serial ë“±ìœ¼ë¡œ ì—°ë™

#### 2) STM32U5 Sensor Module
- **ì´ˆìŒíŒŒ ê±°ë¦¬ í† í”½**: `/ultra_distance_cm`
- **íƒ‘ìŠ¹ ê°ì§€ í† í”½**: `/seat_detected`
- TFT-OLEDì— ì•„ë˜ í† í”½ UI í‘œì‹œ

#### 3) Central Server (Linux/Ubuntu)
- C ê¸°ë°˜ TCP ì„œë²„(ë©€í‹°í”„ë¡œì„¸ìŠ¤)
- MariaDB/MySQL ì—°ë™(ë¡œë´‡ ìƒíƒœ UPSERT, í˜¸ì¶œ í ê´€ë¦¬)
- ë°°ì°¨/ë¡œë´‡ ë§¤ë‹ˆì €/í´ë¼ì´ì–¸íŠ¸ í•¸ë“¤ëŸ¬ í”„ë¡œì„¸ìŠ¤

#### 4) Qt Apps
- **Qt Admin Dashboard**: ê´€ë¦¬ì ëª¨ë‹ˆí„°ë§/ì•Œë¦¼
- **Qt Touch Kiosk**: ì™¸ë˜ í˜¸ì¶œ UI(í„°ì¹˜ìŠ¤í¬ë¦°)

---

## ğŸ—ºï¸ 4. ë™ì‘ ì‹œë‚˜ë¦¬ì˜¤ (Workflow)

### 4.1 ì™¸ë˜ í™˜ì í˜¸ì¶œ(í‚¤ì˜¤ìŠ¤í¬)
1. ì™¸ë˜ í™˜ìê°€ **Qt í‚¤ì˜¤ìŠ¤í¬**ì—ì„œ íœ ì²´ì–´ í˜¸ì¶œ
2. í‚¤ì˜¤ìŠ¤í¬ê°€ ì„œë²„/DBì— í˜¸ì¶œ ë“±ë¡(call queue insert)
3. ì„œë²„ Dispatchê°€ ê°€ìš© ë¡œë´‡ì„ ì„ íƒí•˜ì—¬ ë°°ì°¨
4. ë¡œë´‡ì€ ì¶œë°œì§€ â†’ ëª©ì ì§€ë¡œ Nav2 goal ì´ë™
5. ë„ì°© ì‹œ ì„œë²„/ê´€ë¦¬ì UIì— ì•Œë¦¼

### 4.2 ì…ì› í™˜ì í˜¸ì¶œ(ë³‘ë™/ë³‘ì‹¤ ê¸°ë°˜)
1. ì…ì› í™˜ì/ê´€ë¦¬ìê°€ í˜¸ì¶œ(ë³‘ì‹¤/ë³‘ë™ ì„ íƒ)
2. ì„œë²„ê°€ DBì˜ ìœ„ì¹˜(map_location) ì¢Œí‘œë¥¼ ì°¸ì¡°
3. ë¡œë´‡ ë°°ì°¨ í›„ í•´ë‹¹ ìœ„ì¹˜ë¡œ ì´ë™

### 4.3 íƒ‘ìŠ¹/í•˜ì°¨ íŒë‹¨(ì••ë ¥ ì„¼ì„œ)
- STM32U5ì˜ FSR ì••ë ¥ ì„¼ì„œë¡œ `seat_detected = 1/0` íŒë³„
- Raspberry Pi4ê°€ ì´ë¥¼ ìˆ˜ì‹ í•˜ê³  ì„œë²„ì— ì „ë‹¬í•˜ì—¬ DBì— ê¸°ë¡

### 4.4 í•˜ë‹¨ ì¥ì• ë¬¼ ì•ˆì „(ì´ˆìŒíŒŒ)
- LiDARëŠ” ë³´í†µ ë°”ë‹¥ ê°€ê¹Œìš´ ë‚®ì€ ì¥ì• ë¬¼ì„ ë†“ì¹  ìˆ˜ ìˆìŒ
- STM32U5 ì´ˆìŒíŒŒë¥¼ í•˜ë‹¨ì— ì¥ì°©í•˜ì—¬ `/ultra_distance_cm` publish
- ì„ê³„ ê±°ë¦¬ ì´í•˜ë©´:
    -Nav2 goal cancel/ì¬ê³„íš(ì„¤ê³„ì— ë”°ë¼)

---

## ğŸ“¡ 5. ROS2 í† í”½ ì¸í„°í˜ì´ìŠ¤ (UI í‘œì‹œìš©)

STM32U5 TFT-OLED(ë˜ëŠ” ê´€ë¦¬ì UI)ì— í‘œì‹œí•  í† í”½ë“¤:

| Topic | ì˜ë¯¸ | UI í‘œì‹œ ì˜ˆì‹œ |
|------|------|-------------|
| `/amcl_pose` | ë§µ ê¸°ì¤€ í˜„ì¬ ìœ„ì¹˜ | x, y, yaw |
| `/odom` | odom/ì†ë„ | v, w, ëˆ„ì  |
| `/battery_state` | ë°°í„°ë¦¬ ìƒíƒœ | %, charging |
| `/goal_pose` | ëª©í‘œ ì¢Œí‘œ | goal x, y |
| `/scan` | LiDAR ìŠ¤ìº” | min range |
| `/ultra_distance_cm` | ì´ˆìŒíŒŒ ê±°ë¦¬(cm) | min ê±°ë¦¬ |
| `/seat_detected` | íƒ‘ìŠ¹ ê°ì§€(0/1) | Seated/Empty |

> `/scan`ì€ ë°ì´í„°ê°€ í¬ë¯€ë¡œ UIì—ì„œëŠ” ì¼ë°˜ì ìœ¼ë¡œ **ìµœì†Œ ê±°ë¦¬(min range)** ê°™ì€ ìš”ì•½ê°’ë§Œ í‘œì‹œí•©ë‹ˆë‹¤.

---

## ğŸ§± Database (MariaDB/MySQL)

> ë³¸ í”„ë¡œì íŠ¸ëŠ” `hospital_schema.sql` / `hospital_backup.sql` ê¸°ì¤€ìœ¼ë¡œ DBë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.  
> ì„œë²„(C ì½”ë“œ)ëŠ” DBë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ì¡°íšŒ/ê°±ì‹ í•˜ì—¬ ë°°ì°¨ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

### 1) ì£¼ìš” í…Œì´ë¸” ìš”ì•½

#### âœ… `call_queue` (í˜¸ì¶œ ëŒ€ê¸°ì—´)
ì™¸ë˜ í‚¤ì˜¤ìŠ¤í¬/ì‹œìŠ¤í…œì—ì„œ ìƒì„±í•˜ëŠ” í˜¸ì¶œ ìš”ì²­ì´ ìŒ“ì´ëŠ” í…Œì´ë¸”

- `call_id` (PK, AUTO_INCREMENT)
- `call_time` (DEFAULT current_timestamp)
- `caller_name` (í™˜ì/í˜¸ì¶œì ì´ë¦„)
- `start_loc` (ì¶œë°œì§€: ë¬¸ìì—´)
- `dest_loc` (ëª©ì ì§€: ë¬¸ìì—´)
- `is_dispatched` (0/1)
- `eta` (ë¬¸ìì—´: ì˜ˆ "ì´ë™ì¤‘")

#### âœ… `map_location` (ì¥ì†Œëª… â†’ ì¢Œí‘œ)
ì„œë²„ ë°°ì°¨ ì‹œ `start_loc`, `dest_loc`ì„ (x,y)ë¡œ ë³€í™˜í•  ë•Œ ì‚¬ìš©

- `location_id` (PK)
- `location_name` (UNIQUE)
- `x`, `y`

#### âœ… `robot_status` (ë¡œë´‡ ìƒíƒœ + ëª…ë ¹ ì±„ë„)
ë¡œë´‡ ìƒíƒœë¥¼ ì €ì¥í•˜ê³ , ì„œë²„ê°€ ë¡œë´‡ì—ê²Œ ì¤„ â€œëª…ë ¹(order)â€ ë° ì¢Œí‘œë¥¼ ì €ì¥í•˜ëŠ” í•µì‹¬ í…Œì´ë¸”

- `robot_id` (PK, AUTO_INCREMENT)
- `name` (UNIQUE)  â† ì„œë²„ UPSERTì˜ Key
- `ip_address`
- `op_status` enum('WAITING','HEADING','BOARDING','RUNNING','STOP','ARRIVED','EXITING','CHARGING','ERROR')
- `battery_percent`
- `is_charging`
- `current_x`, `current_y`, `current_theta`
- `start_x`, `start_y`
- `goal_x`, `goal_y`
- `sensor`
- `order`  â† **ëª…ë ¹ ì¡´ì¬ ì—¬ë¶€ íŒë‹¨(ì„œë²„ëŠ” order>0ì´ë©´ ë¡œë´‡ì— ì „ë‹¬)**
- `who_called` â† í˜¸ì¶œì ì´ë¦„ ì €ì¥

#### âœ… `patient_info`, `disease_types` (ìš°ì„ ìˆœìœ„ ë°°ì°¨)
ì„œë²„ ë°°ì°¨ ìš°ì„ ìˆœìœ„ê°€ â€œì‘ê¸‰/ì§ˆë³‘ ìš°ì„ ìˆœìœ„/í˜¸ì¶œ ì‹œê°„â€ì„ ë°˜ì˜í•˜ë„ë¡ ì„¤ê³„ë¨

- `patient_info`
  - `name`, `disease_code`, `is_emergency`, `type(OUT/IN)` ë“±
- `disease_types`
  - `base_priority` (í° ê°’ì¼ìˆ˜ë¡ ìš°ì„ )

ì„œë²„ ë°°ì°¨ ìš°ì„ ìˆœìœ„ ì •ë ¬:
1) `is_emergency` DESC  
2) `base_priority` DESC  
3) `call_time` ASC

---

## ğŸ”§ 7. í•˜ë“œì›¨ì–´ êµ¬ì„± (Hardware)

### âœ… Robot Side
- TurtleBot3 Burger base + LiDAR
- Raspberry Pi 4
- OpenCR

### âœ… STM32U5 Sensor Module
- STM32U5 ë³´ë“œ(ë‚´ì¥ TFT-OLED)
- IUM-100 ì´ˆìŒíŒŒ ì„¼ì„œ (í•˜ë‹¨ ì¥ì• ë¬¼ ê°ì§€)
- FSR ì••ë ¥ ì„¼ì„œ (íƒ‘ìŠ¹ ê°ì§€)
- E-STOP (ì‘ê¸‰ì •ì§€ ë²„íŠ¼)

---

## ğŸ§° 8. ê¸°ìˆ  ìŠ¤íƒ (Tech Stack)

- **Robot**: ROS2, Nav2, SLAM, AMCL
- **Edge**: Raspberry Pi 4
- **Sensor Board**: STM32U5G9J-DK2 + TFT UI
- **Server**: C Socket Server(Multi-process), MariaDB/MySQL
- **UI**: Qt (Admin Dashboard / Touch Kiosk)

---


